# --- Database ---
DB_DRIVER=sqlite
# DATABASE_URL=postgres://user:pass@host:5432/dbname
# Run schema migrations out-of-band in production; keep false by default.
PG_AUTO_SCHEMA=false
PG_POOL_MAX=10
PG_IDLE_TIMEOUT_MS=30000
PG_CONNECT_TIMEOUT_MS=5000

# Outcomes resolver lock for multi-replica Postgres deployments.
OUTCOME_PG_ADVISORY_LOCK=true
# Optional: explicit lock key. Leave empty to derive a stable key from env+db name.
OUTCOME_PG_ADVISORY_LOCK_KEY=
OUTCOME_PG_ADVISORY_LOCK_RETRIES=2
OUTCOME_PG_ADVISORY_LOCK_RETRY_MS=250
OUTCOME_BACKLOG_GRACE_MIN=10

# --- No-lookahead / candle safety ---
# Delay buffer (ms) before trusting the most recent candle close.
# 0 = accept immediately at close; 1500 = wait 1.5s after close.
CLOCK_SKEW_MS=1500

# Hard-fail if candle arrays contain any data at/after entry boundary (defensive for recompute/backtests).
STRICT_NO_LOOKAHEAD=false

# Logs only when trimming actually removes candles.
NO_LOOKAHEAD_LOG=false

# Max number of trim logs before silencing. 0 or unset = unlimited.
NO_LOOKAHEAD_LOG_BUDGET=0

# --- Outcome resolution / horizons ---
# Controls the 15-minute expiry behavior for signal outcomes.
# 
# Options:
# - 'false' (default/recommended): Disable 15m expiry. All horizons resolve naturally.
# - '15': Only the 15m horizon can expire. Longer horizons (30m/60m/120m) resolve normally.
# - 'true': ALL horizons > 15m can be marked EXPIRED_AFTER_15M if the 15m outcome was bad.
#           This was the old behavior that caused "poisoning" of longer horizon stats.
#
# Recommendation: Set to 'false' or '15' for accurate multi-horizon analysis.
OUTCOME_EXPIRE_AFTER_15M=false

# --- Signal Hold Time Recommendation ---
# Based on outcome analysis: 120m/240m horizons show 37-44% win rate vs 6-20% for 15m/30m.
# This setting controls the hold time shown in push notifications and emails.
# Default: 120 minutes (2 hours). Use 240 for 4-hour recommendation.
SIGNAL_HOLD_MINUTES=120

# --- Tuning bundle automation ---
# Bundle retention window (days).
TUNING_BUNDLE_RETENTION_DAYS=14

# Default tuning window (hours) and limits used by the bundle generator.
TUNING_HOURS=6
TUNING_LIMIT=200
TUNING_CATEGORIES=READY_TO_BUY,BEST_ENTRY
TUNING_RESULTS=STOP,TIMEOUT
TUNING_SYMBOL_LIMIT=10

# --- READY quality defaults ---
READY_VWAP_MAX_PCT=0.45
READY_UPPER_WICK_MAX=0.35
READY_MIN_RISK_PCT=0.15
CONFIRM15_VWAP_EPS_PCT=0.25

# === ATR-Based Body Sizing (NEW) ===
# Dynamic body sizing based on ATR with static floor minimums
# Body must be >= (ATR * MULT) AND >= (Price * MIN_PCT). Uses whichever is larger.

# READY entry body requirements
READY_BODY_ATR_MULT=0.40       # Body >= 0.4x ATR
READY_BODY_MIN_PCT=0.008       # Static floor: 0.8% of price

# BEST entry body requirements (stricter)
BEST_BODY_ATR_MULT=0.80        # Body >= 0.8x ATR
BEST_BODY_MIN_PCT=0.015        # Static floor: 1.5% of price

# Body quality thresholds (relaxed defaults)
READY_CLOSE_POS_MIN=0.60       # Close in upper 60% of range (was 0.62)
READY_UPPER_WICK_MAX=0.40      # Upper wick <= 40% of range (was 0.35)
